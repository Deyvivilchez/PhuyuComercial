<!-- ========== THEME SETTINGS MODAL (DEFAULT: light-blue + nav light + vertical) ========== -->
<div
  class="modal fade modal-right scroll-out-negative"
  id="settings"
  data-bs-backdrop="true"
  tabindex="-1"
  role="dialog"
  aria-labelledby="settings"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-scrollable full" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Theme Settings</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="scroll-track-visible">

          <!-- Color -->
          <div class="mb-5" id="color">
            <label class="mb-3 d-inline-block form-label">Color</label>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-blue" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw blue-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT BLUE</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-blue" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw blue-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK BLUE</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-teal" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw teal-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT TEAL</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-teal" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw teal-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK TEAL</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-sky" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw sky-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT SKY</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-sky" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw sky-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK SKY</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-red" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw red-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT RED</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-red" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw red-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK RED</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-green" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw green-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT GREEN</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-green" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw green-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK GREEN</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-lime" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw lime-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT LIME</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-lime" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw lime-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK LIME</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-pink" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw pink-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT PINK</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-pink" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw pink-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK PINK</span></div>
              </a>
            </div>

            <div class="row d-flex g-3 justify-content-between flex-wrap mb-3">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="light-purple" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw purple-light"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT PURPLE</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="dark-purple" data-parent="color">
                <div class="card rounded-md p-3 mb-1 no-shadow color"><div class="sw purple-dark"></div></div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK PURPLE</span></div>
              </a>
            </div>
          </div>

          <!-- Nav Palette -->
          <div class="mb-5" id="navcolor">
            <label class="mb-3 d-inline-block form-label">Override Nav Palette</label>
            <div class="row d-flex g-3 justify-content-between flex-wrap">
              <a href="#" class="flex-grow-1 w-33 option col" data-value="default" data-parent="navcolor">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DEFAULT</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-33 option col" data-value="light" data-parent="navcolor">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-secondary figure-light top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">LIGHT</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-33 option col" data-value="dark" data-parent="navcolor">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-muted figure-dark top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">DARK</span></div>
              </a>
            </div>
          </div>

          <!-- Placement -->
          <div class="mb-5" id="placement">
            <label class="mb-3 d-inline-block form-label">Menu Placement</label>
            <div class="row d-flex g-3 justify-content-between flex-wrap">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="horizontal" data-parent="placement">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">HORIZONTAL</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="vertical" data-parent="placement">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary left"></div>
                  <div class="figure figure-secondary right"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">VERTICAL</span></div>
              </a>
            </div>
          </div>

          <!-- Behaviour -->
          <div class="mb-5" id="behaviour">
            <label class="mb-3 d-inline-block form-label">Menu Behaviour</label>
            <div class="row d-flex g-3 justify-content-between flex-wrap">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="pinned" data-parent="behaviour">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary left large"></div>
                  <div class="figure figure-secondary right small"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">PINNED</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="unpinned" data-parent="behaviour">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary left"></div>
                  <div class="figure figure-secondary right"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">UNPINNED</span></div>
              </a>
            </div>
          </div>

          <!-- Layout -->
          <div class="mb-5" id="layout">
            <label class="mb-3 d-inline-block form-label">Layout</label>
            <div class="row d-flex g-3 justify-content-between flex-wrap">
              <a href="#" class="flex-grow-1 w-50 option col" data-value="fluid" data-parent="layout">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">FLUID</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-50 option col" data-value="boxed" data-parent="layout">
                <div class="card rounded-md p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom small"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">BOXED</span></div>
              </a>
            </div>
          </div>

          <!-- Radius -->
          <div class="mb-5" id="radius">
            <label class="mb-3 d-inline-block form-label">Radius</label>
            <div class="row d-flex g-3 justify-content-between flex-wrap">
              <a href="#" class="flex-grow-1 w-33 option col" data-value="rounded" data-parent="radius">
                <div class="card rounded-md radius-rounded p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">ROUNDED</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-33 option col" data-value="standard" data-parent="radius">
                <div class="card rounded-md radius-regular p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">STANDARD</span></div>
              </a>
              <a href="#" class="flex-grow-1 w-33 option col" data-value="flat" data-parent="radius">
                <div class="card rounded-md radius-flat p-3 mb-1 no-shadow">
                  <div class="figure figure-primary top"></div>
                  <div class="figure figure-secondary bottom"></div>
                </div>
                <div class="text-muted text-part"><span class="text-extra-small align-middle">FLAT</span></div>
              </a>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<!-- ===== Estilos: variables + chips + sidebar tint ===== -->
<style>
  /* Variables por defecto (marca Phuyu: celeste→violeta) */
  :root{
    --accent-1:#38bdf8; /* celeste */
    --accent-2:#6366f1; /* violeta */
    --bg-soft-start:#f8fafc;
    --bg-soft-end:#e0f2fe;
    --text-strong:#111827;
    --text-muted:#6b7280;
  }

  /* Chips de color (vista previa real) */
  .color .sw{height:28px;border-radius:10px;border:1px solid rgba(0,0,0,.08);}
  .blue-light{background:linear-gradient(90deg,#38bdf8,#6366f1);}
  .blue-dark{background:linear-gradient(90deg,#22d3ee,#4338ca);}
  .teal-light{background:linear-gradient(90deg,#2dd4bf,#14b8a6);}
  .teal-dark{background:linear-gradient(90deg,#2dd4bf,#0d9488);}
  .sky-light{background:linear-gradient(90deg,#38bdf8,#60a5fa);}
  .sky-dark{background:linear-gradient(90deg,#38bdf8,#0ea5e9);}
  .red-light{background:linear-gradient(90deg,#fb7185,#ef4444);}
  .red-dark{background:linear-gradient(90deg,#f87171,#b91c1c);}
  .green-light{background:linear-gradient(90deg,#34d399,#10b981);}
  .green-dark{background:linear-gradient(90deg,#34d399,#059669);}
  .lime-light{background:linear-gradient(90deg,#a3e635,#84cc16);}
  .lime-dark{background:linear-gradient(90deg,#a3e635,#65a30d);}
  .pink-light{background:linear-gradient(90deg,#f472b6,#ec4899);}
  .pink-dark{background:linear-gradient(90deg,#f472b6,#db2777);}
  .purple-light{background:linear-gradient(90deg,#a78bfa,#6366f1);}
  .purple-dark{background:linear-gradient(90deg,#c084fc,#7c3aed);}

  /* Marca activa en el modal */
  #settings .option{cursor:pointer}
  #settings .option.active .card{outline:3px solid rgba(0,0,0,.2)}
  [data-bs-theme="dark"] #settings .option.active .card{outline-color:rgba(255,255,255,.35)}

  /* Tinte suave sidebar vertical por defecto (usa variables) */
  html[data-placement="vertical"] .menu,
  html[data-placement="vertical"] .sidebar,
  html[data-placement="vertical"] .nav-container{
    background:
      linear-gradient(180deg, color-mix(in srgb, var(--accent-1) 18%, #ffffff 82%) 0%,
                            color-mix(in srgb, var(--accent-2) 18%, #ffffff 82%) 100%),
      #fff;
    border-right:1px solid color-mix(in srgb, var(--accent-2) 20%, #ffffff 80%);
    box-shadow: inset -1px 0 0 rgba(15,23,42,.06);
  }

  /* Botón Reset flotante */
  #themeResetBtn{
    position:fixed; right:20px; bottom:20px; z-index:1050;
    background: var(--accent-2); color:#fff; border:0; border-radius:999px;
    padding:10px 16px; font-weight:800; box-shadow:0 6px 16px rgba(0,0,0,.2);
    cursor:pointer; transition:transform .15s ease, filter .15s ease;
  }
  #themeResetBtn:hover{ transform:translateY(-1px); filter:brightness(.97); }
</style>

<!-- ===== Lógica: aplica data-* y variables CSS según la paleta ===== -->
<script>
(() => {
  const STORAGE_KEY = 'uiThemeConfig';
  const DEFAULTS = {
    color: 'light-blue',   // por defecto misma paleta que login/administrar
    navcolor: 'light',
    placement: 'vertical',
    behaviour: 'pinned',
    layout: 'boxed',
    radius: 'rounded'
  };

  // Mapeo de paletas -> variables CSS
  const PALETTES = {
    'light-blue':   {a1:'#38bdf8', a2:'#6366f1', bg1:'#f8fafc', bg2:'#e0f2fe', dark:false},
    'dark-blue':    {a1:'#22d3ee', a2:'#4338ca', bg1:'#0b1220', bg2:'#0e1628', dark:true},
    'light-teal':   {a1:'#2dd4bf', a2:'#14b8a6', bg1:'#f0fdfa', bg2:'#ccfbf1', dark:false},
    'dark-teal':    {a1:'#2dd4bf', a2:'#0d9488', bg1:'#052b27', bg2:'#083a33', dark:true},
    'light-sky':    {a1:'#38bdf8', a2:'#60a5fa', bg1:'#f0f9ff', bg2:'#e0f2fe', dark:false},
    'dark-sky':     {a1:'#38bdf8', a2:'#0ea5e9', bg1:'#0b1220', bg2:'#0e1628', dark:true},
    'light-red':    {a1:'#fb7185', a2:'#ef4444', bg1:'#fef2f2', bg2:'#fee2e2', dark:false},
    'dark-red':     {a1:'#f87171', a2:'#b91c1c', bg1:'#240a0a', bg2:'#2a0f0f', dark:true},
    'light-green':  {a1:'#34d399', a2:'#10b981', bg1:'#f0fdf4', bg2:'#dcfce7', dark:false},
    'dark-green':   {a1:'#34d399', a2:'#059669', bg1:'#071b12', bg2:'#0b291c', dark:true},
    'light-lime':   {a1:'#a3e635', a2:'#84cc16', bg1:'#f7fee7', bg2:'#ecfccb', dark:false},
    'dark-lime':    {a1:'#a3e635', a2:'#65a30d', bg1:'#1a2405', bg2:'#1f2d08', dark:true},
    'light-pink':   {a1:'#f472b6', a2:'#ec4899', bg1:'#fdf2f8', bg2:'#fce7f3', dark:false},
    'dark-pink':    {a1:'#f472b6', a2:'#db2777', bg1:'#2a0d1d', bg2:'#3b0f28', dark:true},
    'light-purple': {a1:'#a78bfa', a2:'#6366f1', bg1:'#faf5ff', bg2:'#eef2ff', dark:false},
    'dark-purple':  {a1:'#c084fc', a2:'#7c3aed', bg1:'#160a2a', bg2:'#1d1036', dark:true},
    '_fallback':    {a1:'#38bdf8', a2:'#6366f1', bg1:'#f8fafc', bg2:'#e0f2fe', dark:false}
  };

  const ATTR_MAP = {
    color:'data-color', navcolor:'data-navcolor', placement:'data-placement',
    behaviour:'data-behaviour', layout:'data-layout', radius:'data-radius'
  };

  const htmlEl = document.documentElement;
  let cssVarsTag;

  const getCfg = () => {
    try { return { ...DEFAULTS, ...(JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}')) }; }
    catch { return { ...DEFAULTS }; }
  };

  function applyAttrs(cfg){
    for(const [k,v] of Object.entries(cfg)){
      const a = ATTR_MAP[k]; if(a) htmlEl.setAttribute(a, String(v));
    }
    // tema claro/oscuro para Bootstrap
    const pal = PALETTES[cfg.color] || PALETTES._fallback;
    htmlEl.setAttribute('data-bs-theme', pal.dark ? 'dark' : 'light');
  }

  function applyVars(colorKey){
    const p = PALETTES[colorKey] || PALETTES._fallback;
    if(!cssVarsTag){ cssVarsTag = document.createElement('style'); document.head.appendChild(cssVarsTag); }
    cssVarsTag.textContent = `
      :root{
        --accent-1:${p.a1}; --accent-2:${p.a2};
        --bg-soft-start:${p.bg1}; --bg-soft-end:${p.bg2};
        --text-strong:${p.dark ? '#e5e7eb' : '#111827'};
        --text-muted:${p.dark ? '#9ca3af' : '#6b7280'};
      }
    `;
  }

  function markActive(cfg){
    document.querySelectorAll('#settings .option.active').forEach(el => el.classList.remove('active'));
    Object.entries(cfg).forEach(([k,v])=>{
      const el = document.querySelector(`#settings .option[data-parent="${k}"][data-value="${v}"]`);
      if(el) el.classList.add('active');
    });
  }

  function applyTheme(cfg){
    applyAttrs(cfg);
    applyVars(cfg.color);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
    markActive(cfg);
  }

  function init(){
    applyTheme(getCfg());

    document.addEventListener('click', (e)=>{
      const opt = e.target.closest('#settings .option');
      if(!opt) return;
      e.preventDefault();
      const parent = opt.dataset.parent, value = opt.dataset.value;
      if(!(parent in ATTR_MAP)) return;
      applyTheme({ ...getCfg(), [parent]: value });
    });

    ensureResetBtn();
  }

  function ensureResetBtn(){
    if(document.getElementById('themeResetBtn')) return;
    const b = document.createElement('button');
    b.id='themeResetBtn'; b.type='button'; b.textContent='⟳ Reset tema';
    b.onclick = ()=> applyTheme({ ...DEFAULTS });
    document.body.appendChild(b);
  }

  document.readyState === 'loading'
    ? document.addEventListener('DOMContentLoaded', init)
    : init();
})();
</script>
